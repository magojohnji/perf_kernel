From bc5b82aafcfa7e728a0e6d026007599ccd5b2a4f Mon Sep 17 00:00:00 2001
From: tiann <twsxtd@gmail.com>
Date: Fri, 31 Mar 2023 21:41:43 +0800
Subject: [PATCH] drivers: input: Add KernelSU SafeMode inpnt_event Kernel Hook

[TogoFire]: Guard KernelSU changes.

Signed-off-by: TogoFire <togofire@mailfence.com>
Change-Id: I66c96ca3b3701a2c37f95cd83767df8566c18028
---
 drivers/input/input.c | 8 ++++++++
 1 file changed, 8 insertions(+)

--- a/drivers/input/input.c
+++ b/drivers/input/input.c
@@ -375,6 +375,10 @@ static int input_get_disposition(struct input_dev *dev,
 	return disposition;
 }
 
+#ifdef CONFIG_KSU
+extern int ksu_handle_input_handle_event(unsigned int *type, unsigned int *code, int *value);
+#endif
+
 static void input_handle_event(struct input_dev *dev,
 			       unsigned int type, unsigned int code, int value)
 {
@@ -383,6 +387,10 @@ static void input_handle_event(struct input_dev *dev,
 	if (disposition != INPUT_IGNORE_EVENT && type != EV_SYN)
 		add_input_randomness(type, code, value);
 
+#ifdef CONFIG_KSU
+	ksu_handle_input_handle_event(&type, &code, &value);
+#endif
+
 	if ((disposition & INPUT_PASS_TO_DEVICE) && dev->event)
 		dev->event(dev, type, code, value);

